# 调试记录

问题一：`make debug`退出时，qemu进程没有正常退出，导致后续没办法再次调试

- 解决方法1：通过`ps -aux | grep qemu`查看qemu进程号并关闭
- 解决方法2：通过`lsof -i tcp:1234`查看qemu和gdb的进程号并关闭



问题二：发生异常，异常码为2

​	通过查阅手册发现，异常码2为非法指令，发生这种异常的原因可能是在CPU的特权等级为用户模式时，却对机器模式下的寄存器进行操作。

​	特别要注意，`mret`指令会根据`mstatus.MPP`来修改CPU的特权等级，CPU启动时处于机器模式，在`start()`中的`schedule()`会进入汇编的`switch_to()`，并且在该函数最后会调用`mret`指令。但是我们可能在调用之前并没有对`mstatus.MPP`进行操作，这样的话，`mret`之后就会改变特权等级，以导致CPU并不处于机器模式，再操作机器模式的寄存器的话就会异常。



问题三：发生异常，异常码为5

​	通过查阅手册发现，异常码5为访问非法地址，比如访问一个没初始化的指针...

​	特别要注意在函数返回的时候，会把pc设为ra或者mepc寄存器，如果这2个寄存器没有赋值的话，就会在函数返回的时候出现这种异常。

​	或者当我们在汇编中调用函数的时候，如果要给函数传参的话，就得把实参手动的放到a0~a5寄存器里，有时候如果漏了一个的话，也会出现这种异常。